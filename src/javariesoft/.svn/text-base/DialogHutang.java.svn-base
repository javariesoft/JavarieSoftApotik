/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * DialogHutang.java
 *
 * Created on Dec 29, 2011, 5:52:28 PM
 */
package javariesoft;

import com.erv.db.bankDao;
import com.erv.db.hutangDao;
import com.erv.db.hutangbayarDao;
import com.erv.db.jurnalDao;
import com.erv.db.koneksi;
import com.erv.db.pembelianDao;
import com.erv.db.settingDao;
import com.erv.db.supplierDao;
import com.erv.function.JDBCAdapter;
import com.erv.model.hutang;
import com.erv.model.hutangbayar;
import com.erv.model.jurnal;
import com.erv.model.pembelian;
import com.erv.model.supplier;
import java.awt.Font;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.JTable;

/**
 *
 * @author erwadi
 */
public class DialogHutang extends javax.swing.JDialog {
    String ID[];
    int IDJurnal=0;
    java.text.DateFormat d = new SimpleDateFormat("yyyy-MM-dd");
    Connection c;
    hutang ht;
    String pilSupplier= "0";
    int IDBELI = 0;
    String kodeSupplier="";
    int IDHUTANG=0;
    pembelian p;
    /** Creates new form DialogHutang */
    public DialogHutang(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        setting(); 
    }
    public DialogHutang(java.awt.Frame parent, boolean modal,String idpembelian) {
        super(parent, modal);
        initComponents();
        setting();
        try {
            p=pembelianDao.getDetails(c, Integer.parseInt(idpembelian));
            txtKodeSupplier1.setText(p.getIDSUPPLIER());
            txtNamaSupplier1.setText(supplierDao.getDetails(c, p.getIDSUPPLIER()).getNAMA());
            reloadDataHutangBayar();
            jTabbedPane1.setSelectedIndex(1);
        } catch (SQLException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    public void setting() {
        try {
            c = koneksi.getKoneksiJ();
            ht = new hutang();
            kosongHutang();
            kosongBayar();
            isiCombo();
            tglHutang.setDateFormat(d);
            jScrollPane4.setVisible(false);
            jScrollPane4.setSize(500, 150);
            tglBayar.setDateFormat(d);
            tglHutang.setDateFormat(d);
            tglJatuhTempo.setDateFormat(d);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        } catch (SQLException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panelCool1 = new com.erv.function.PanelCool();
        jScrollPane4 = new javax.swing.JScrollPane();
        jTable4 = new javax.swing.JTable();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        txtKodeHutang = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtNoref = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        tglHutang = new datechooser.beans.DateChooserCombo();
        jLabel11 = new javax.swing.JLabel();
        tglJatuhTempo = new datechooser.beans.DateChooserCombo();
        jLabel1 = new javax.swing.JLabel();
        txtSupplier = new javax.swing.JTextField();
        txtNamaSupplier = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        txtJumlahHutang = new javax.swing.JFormattedTextField();
        jLabel13 = new javax.swing.JLabel();
        txtKeterangan = new javax.swing.JTextField();
        cmdInsert = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTable2 = new javax.swing.JTable();
        jSeparator1 = new javax.swing.JSeparator();
        btnUpdate = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel14 = new javax.swing.JLabel();
        tglBayar = new datechooser.beans.DateChooserCombo();
        jLabel15 = new javax.swing.JLabel();
        txtKodeSupplier1 = new javax.swing.JTextField();
        txtNamaSupplier1 = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jLabel6 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        cboCaraBayar = new javax.swing.JComboBox();
        cboBank = new javax.swing.JComboBox();
        txtJumlahBayar = new javax.swing.JFormattedTextField();
        jSeparator2 = new javax.swing.JSeparator();
        jLabel7 = new javax.swing.JLabel();
        txtTotalHutang = new javax.swing.JFormattedTextField();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTable3 = new javax.swing.JTable();
        btnSimpan = new javax.swing.JButton();
        jLabel16 = new javax.swing.JLabel();
        txtNoTrans = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setName("Form"); // NOI18N

        panelCool1.setName("panelCool1"); // NOI18N
        panelCool1.setLayout(null);

        jScrollPane4.setName("jScrollPane4"); // NOI18N

        jTable4.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jTable4.setName("jTable4"); // NOI18N
        jTable4.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTable4KeyPressed(evt);
            }
        });
        jScrollPane4.setViewportView(jTable4);

        panelCool1.add(jScrollPane4);
        jScrollPane4.setBounds(150, 150, 50, 20);

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(javariesoft.JavarieSoftApp.class).getContext().getResourceMap(DialogHutang.class);
        jTabbedPane1.setFont(resourceMap.getFont("jTabbedPane1.font")); // NOI18N
        jTabbedPane1.setName("jTabbedPane1"); // NOI18N

        jPanel1.setName("jPanel1"); // NOI18N
        jPanel1.setLayout(null);

        txtKodeHutang.setFont(resourceMap.getFont("txtKodeHutang.font")); // NOI18N
        txtKodeHutang.setText(resourceMap.getString("txtKodeHutang.text")); // NOI18N
        txtKodeHutang.setName("txtKodeHutang"); // NOI18N
        txtKodeHutang.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtKodeHutangKeyPressed(evt);
            }
        });
        jPanel1.add(txtKodeHutang);
        txtKodeHutang.setBounds(140, 20, 160, 22);

        jLabel2.setFont(resourceMap.getFont("jLabel2.font")); // NOI18N
        jLabel2.setForeground(resourceMap.getColor("jLabel2.foreground")); // NOI18N
        jLabel2.setText(resourceMap.getString("jLabel2.text")); // NOI18N
        jLabel2.setName("jLabel2"); // NOI18N
        jPanel1.add(jLabel2);
        jLabel2.setBounds(20, 20, 100, 16);

        jLabel3.setFont(resourceMap.getFont("jLabel3.font")); // NOI18N
        jLabel3.setForeground(resourceMap.getColor("jLabel3.foreground")); // NOI18N
        jLabel3.setText(resourceMap.getString("jLabel3.text")); // NOI18N
        jLabel3.setName("jLabel3"); // NOI18N
        jPanel1.add(jLabel3);
        jLabel3.setBounds(320, 20, 100, 16);

        txtNoref.setFont(resourceMap.getFont("txtNoref.font")); // NOI18N
        txtNoref.setText(resourceMap.getString("txtNoref.text")); // NOI18N
        txtNoref.setName("txtNoref"); // NOI18N
        txtNoref.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtNorefKeyPressed(evt);
            }
        });
        jPanel1.add(txtNoref);
        txtNoref.setBounds(420, 20, 160, 22);

        jLabel8.setFont(resourceMap.getFont("jLabel8.font")); // NOI18N
        jLabel8.setForeground(resourceMap.getColor("jLabel8.foreground")); // NOI18N
        jLabel8.setText(resourceMap.getString("jLabel8.text")); // NOI18N
        jLabel8.setName("jLabel8"); // NOI18N
        jPanel1.add(jLabel8);
        jLabel8.setBounds(320, 50, 100, 16);

        tglHutang.setFieldFont(resourceMap.getFont("tglHutang.dch_combo_fieldFont")); // NOI18N
        jPanel1.add(tglHutang);
        tglHutang.setBounds(140, 50, 155, 20);

        jLabel11.setFont(resourceMap.getFont("jLabel11.font")); // NOI18N
        jLabel11.setText(resourceMap.getString("jLabel11.text")); // NOI18N
        jLabel11.setName("jLabel11"); // NOI18N
        jPanel1.add(jLabel11);
        jLabel11.setBounds(20, 50, 100, 16);

        tglJatuhTempo.setFieldFont(resourceMap.getFont("tglJatuhTempo.dch_combo_fieldFont")); // NOI18N
        jPanel1.add(tglJatuhTempo);
        tglJatuhTempo.setBounds(420, 50, 155, 20);

        jLabel1.setFont(resourceMap.getFont("jLabel1.font")); // NOI18N
        jLabel1.setForeground(resourceMap.getColor("jLabel1.foreground")); // NOI18N
        jLabel1.setText(resourceMap.getString("jLabel1.text")); // NOI18N
        jLabel1.setName("jLabel1"); // NOI18N
        jPanel1.add(jLabel1);
        jLabel1.setBounds(20, 140, 100, 16);

        txtSupplier.setFont(resourceMap.getFont("txtSupplier.font")); // NOI18N
        txtSupplier.setText(resourceMap.getString("txtSupplier.text")); // NOI18N
        txtSupplier.setName("txtSupplier"); // NOI18N
        txtSupplier.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtSupplierActionPerformed(evt);
            }
        });
        txtSupplier.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtSupplierKeyPressed(evt);
            }
        });
        jPanel1.add(txtSupplier);
        txtSupplier.setBounds(140, 80, 130, 21);

        txtNamaSupplier.setFont(resourceMap.getFont("txtNamaSupplier.font")); // NOI18N
        txtNamaSupplier.setText(resourceMap.getString("txtNamaSupplier.text")); // NOI18N
        txtNamaSupplier.setName("txtNamaSupplier"); // NOI18N
        jPanel1.add(txtNamaSupplier);
        txtNamaSupplier.setBounds(270, 80, 300, 21);

        jLabel12.setFont(resourceMap.getFont("jLabel12.font")); // NOI18N
        jLabel12.setText(resourceMap.getString("jLabel12.text")); // NOI18N
        jLabel12.setName("jLabel12"); // NOI18N
        jPanel1.add(jLabel12);
        jLabel12.setBounds(20, 80, 100, 16);

        txtJumlahHutang.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0"))));
        txtJumlahHutang.setFont(resourceMap.getFont("txtJumlahHutang.font")); // NOI18N
        txtJumlahHutang.setName("txtJumlahHutang"); // NOI18N
        txtJumlahHutang.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtJumlahHutangKeyPressed(evt);
            }
        });
        jPanel1.add(txtJumlahHutang);
        txtJumlahHutang.setBounds(140, 110, 160, 22);

        jLabel13.setFont(resourceMap.getFont("jLabel13.font")); // NOI18N
        jLabel13.setText(resourceMap.getString("jLabel13.text")); // NOI18N
        jLabel13.setName("jLabel13"); // NOI18N
        jPanel1.add(jLabel13);
        jLabel13.setBounds(20, 110, 100, 16);

        txtKeterangan.setFont(resourceMap.getFont("txtKeterangan.font")); // NOI18N
        txtKeterangan.setText(resourceMap.getString("txtKeterangan.text")); // NOI18N
        txtKeterangan.setName("txtKeterangan"); // NOI18N
        txtKeterangan.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtKeteranganKeyPressed(evt);
            }
        });
        jPanel1.add(txtKeterangan);
        txtKeterangan.setBounds(140, 140, 440, 21);

        cmdInsert.setFont(resourceMap.getFont("cmdInsert.font")); // NOI18N
        cmdInsert.setIcon(resourceMap.getIcon("cmdInsert.icon")); // NOI18N
        cmdInsert.setText(resourceMap.getString("cmdInsert.text")); // NOI18N
        cmdInsert.setName("cmdInsert"); // NOI18N
        cmdInsert.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdInsertActionPerformed(evt);
            }
        });
        jPanel1.add(cmdInsert);
        cmdInsert.setBounds(20, 170, 100, 30);

        jScrollPane2.setName("jScrollPane2"); // NOI18N

        jTable2.setName("jTable2"); // NOI18N
        jTable2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable2MouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(jTable2);

        jPanel1.add(jScrollPane2);
        jScrollPane2.setBounds(20, 220, 730, 180);

        jSeparator1.setName("jSeparator1"); // NOI18N
        jPanel1.add(jSeparator1);
        jSeparator1.setBounds(20, 210, 730, 10);

        btnUpdate.setFont(resourceMap.getFont("btnUpdate.font")); // NOI18N
        btnUpdate.setIcon(resourceMap.getIcon("btnUpdate.icon")); // NOI18N
        btnUpdate.setText(resourceMap.getString("btnUpdate.text")); // NOI18N
        btnUpdate.setName("btnUpdate"); // NOI18N
        btnUpdate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUpdateActionPerformed(evt);
            }
        });
        jPanel1.add(btnUpdate);
        btnUpdate.setBounds(130, 170, 110, 30);

        jTabbedPane1.addTab(resourceMap.getString("jPanel1.TabConstraints.tabTitle"), jPanel1); // NOI18N

        jPanel2.setName("jPanel2"); // NOI18N
        jPanel2.setLayout(null);

        jLabel14.setFont(resourceMap.getFont("jLabel14.font")); // NOI18N
        jLabel14.setText(resourceMap.getString("jLabel14.text")); // NOI18N
        jLabel14.setName("jLabel14"); // NOI18N
        jPanel2.add(jLabel14);
        jLabel14.setBounds(20, 80, 110, 15);

        tglBayar.setFieldFont(resourceMap.getFont("tglBayar.dch_combo_fieldFont")); // NOI18N
        jPanel2.add(tglBayar);
        tglBayar.setBounds(150, 50, 155, 20);

        jLabel15.setFont(resourceMap.getFont("jLabel15.font")); // NOI18N
        jLabel15.setText(resourceMap.getString("jLabel15.text")); // NOI18N
        jLabel15.setName("jLabel15"); // NOI18N
        jPanel2.add(jLabel15);
        jLabel15.setBounds(20, 20, 110, 16);

        txtKodeSupplier1.setFont(resourceMap.getFont("txtKodeSupplier1.font")); // NOI18N
        txtKodeSupplier1.setText(resourceMap.getString("txtKodeSupplier1.text")); // NOI18N
        txtKodeSupplier1.setName("txtKodeSupplier1"); // NOI18N
        txtKodeSupplier1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtKodeSupplier1ActionPerformed(evt);
            }
        });
        txtKodeSupplier1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtKodeSupplier1KeyPressed(evt);
            }
        });
        jPanel2.add(txtKodeSupplier1);
        txtKodeSupplier1.setBounds(150, 80, 130, 21);

        txtNamaSupplier1.setFont(resourceMap.getFont("txtNamaSupplier1.font")); // NOI18N
        txtNamaSupplier1.setText(resourceMap.getString("txtNamaSupplier1.text")); // NOI18N
        txtNamaSupplier1.setName("txtNamaSupplier1"); // NOI18N
        jPanel2.add(txtNamaSupplier1);
        txtNamaSupplier1.setBounds(290, 80, 260, 21);

        jScrollPane1.setName("jScrollPane1"); // NOI18N

        jTable1.setName("jTable1"); // NOI18N
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable1MouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(jTable1);

        jPanel2.add(jScrollPane1);
        jScrollPane1.setBounds(20, 110, 730, 110);

        jLabel6.setFont(resourceMap.getFont("jLabel6.font")); // NOI18N
        jLabel6.setForeground(resourceMap.getColor("jLabel6.foreground")); // NOI18N
        jLabel6.setText(resourceMap.getString("jLabel6.text")); // NOI18N
        jLabel6.setName("jLabel6"); // NOI18N
        jPanel2.add(jLabel6);
        jLabel6.setBounds(30, 230, 100, 16);

        jLabel9.setFont(resourceMap.getFont("jLabel9.font")); // NOI18N
        jLabel9.setForeground(resourceMap.getColor("jLabel9.foreground")); // NOI18N
        jLabel9.setText(resourceMap.getString("jLabel9.text")); // NOI18N
        jLabel9.setName("jLabel9"); // NOI18N
        jPanel2.add(jLabel9);
        jLabel9.setBounds(320, 50, 100, 16);

        cboCaraBayar.setFont(resourceMap.getFont("cboCaraBayar.font")); // NOI18N
        cboCaraBayar.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "KAS", "BANK" }));
        cboCaraBayar.setName("cboCaraBayar"); // NOI18N
        jPanel2.add(cboCaraBayar);
        cboCaraBayar.setBounds(410, 50, 100, 22);

        cboBank.setFont(resourceMap.getFont("cboBank.font")); // NOI18N
        cboBank.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cboBank.setName("cboBank"); // NOI18N
        jPanel2.add(cboBank);
        cboBank.setBounds(520, 50, 100, 22);

        txtJumlahBayar.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0"))));
        txtJumlahBayar.setFont(resourceMap.getFont("txtJumlahBayar.font")); // NOI18N
        txtJumlahBayar.setName("txtJumlahBayar"); // NOI18N
        jPanel2.add(txtJumlahBayar);
        txtJumlahBayar.setBounds(480, 230, 150, 21);

        jSeparator2.setName("jSeparator2"); // NOI18N
        jPanel2.add(jSeparator2);
        jSeparator2.setBounds(20, 260, 730, 10);

        jLabel7.setFont(resourceMap.getFont("jLabel7.font")); // NOI18N
        jLabel7.setText(resourceMap.getString("jLabel7.text")); // NOI18N
        jLabel7.setName("jLabel7"); // NOI18N
        jPanel2.add(jLabel7);
        jLabel7.setBounds(360, 230, 100, 16);

        txtTotalHutang.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0"))));
        txtTotalHutang.setFont(resourceMap.getFont("txtTotalHutang.font")); // NOI18N
        txtTotalHutang.setName("txtTotalHutang"); // NOI18N
        jPanel2.add(txtTotalHutang);
        txtTotalHutang.setBounds(150, 230, 160, 21);

        jScrollPane3.setName("jScrollPane3"); // NOI18N

        jTable3.setName("jTable3"); // NOI18N
        jScrollPane3.setViewportView(jTable3);

        jPanel2.add(jScrollPane3);
        jScrollPane3.setBounds(150, 280, 600, 120);

        btnSimpan.setFont(resourceMap.getFont("btnSimpan.font")); // NOI18N
        btnSimpan.setText(resourceMap.getString("btnSimpan.text")); // NOI18N
        btnSimpan.setName("btnSimpan"); // NOI18N
        btnSimpan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSimpanActionPerformed(evt);
            }
        });
        jPanel2.add(btnSimpan);
        btnSimpan.setBounds(20, 280, 80, 30);

        jLabel16.setFont(resourceMap.getFont("jLabel16.font")); // NOI18N
        jLabel16.setText(resourceMap.getString("jLabel16.text")); // NOI18N
        jLabel16.setName("jLabel16"); // NOI18N
        jPanel2.add(jLabel16);
        jLabel16.setBounds(20, 50, 110, 16);

        txtNoTrans.setFont(resourceMap.getFont("txtNoTrans.font")); // NOI18N
        txtNoTrans.setText(resourceMap.getString("txtNoTrans.text")); // NOI18N
        txtNoTrans.setName("txtNoTrans"); // NOI18N
        jPanel2.add(txtNoTrans);
        txtNoTrans.setBounds(150, 20, 150, 21);

        jTabbedPane1.addTab(resourceMap.getString("jPanel2.TabConstraints.tabTitle"), jPanel2); // NOI18N

        panelCool1.add(jTabbedPane1);
        jTabbedPane1.setBounds(10, 10, 770, 450);

        getContentPane().add(panelCool1, java.awt.BorderLayout.CENTER);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-811)/2, (screenSize.height-519)/2, 811, 519);
    }// </editor-fold>//GEN-END:initComponents

private void cmdInsertActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdInsertActionPerformed
// TODO add your handling code here:
    prosesSimpan("0");
    reloadDataHutang();
    kosongHutang();
}//GEN-LAST:event_cmdInsertActionPerformed

private void txtSupplierActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtSupplierActionPerformed
// TODO add your handling code here:
     jScrollPane4.setVisible(true);
    JDBCAdapter ja = new JDBCAdapter(c);
    ja.executeQuery("select IDSUPPLIER,NAMA from SUPPLIER where IDSUPPLIER like '" + txtSupplier.getText() + "%' or lower(NAMA) like '" + txtSupplier.getText().toLowerCase() + "%'");
    jScrollPane4.getViewport().remove(jTable4);
    jTable4 = new JTable(ja);
    jTable4.addKeyListener(new java.awt.event.KeyAdapter() {
            @Override
        public void keyPressed(java.awt.event.KeyEvent evt) {
            jTable4KeyPressed(evt);
        }
    });
    jTable4.setFont(new Font("Tahoma", Font.BOLD, 12));
    jScrollPane4.getViewport().add(jTable4);
    jScrollPane4.repaint();
}//GEN-LAST:event_txtSupplierActionPerformed

private void jTable4KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTable4KeyPressed
// TODO add your handling code here:
    if (evt.getKeyCode() == 10) {
        try {
            supplier b = new supplier();
            b = supplierDao.getDetails(c,jTable4.getValueAt(jTable4.getSelectedRow(), 0).toString());
            if(pilSupplier.equals("0")){
                txtSupplier.setText(b.getIDSUPPLIER());
                txtNamaSupplier.setText(b.getNAMA());
                jScrollPane4.setVisible(false);
                reloadDataHutang();
                txtJumlahHutang.requestFocus();
            }else if(pilSupplier.equals("1")){
                txtKodeSupplier1.setText(b.getIDSUPPLIER());
                txtNamaSupplier1.setText(b.getNAMA());
                jScrollPane4.setVisible(false);    
                reloadDataHutangBayar();
            }
            
        } catch (Exception ex) {
            
        }
    }
}//GEN-LAST:event_jTable4KeyPressed

private void txtSupplierKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtSupplierKeyPressed
// TODO add your handling code here:
    if (evt.getKeyCode() == 40) {
        pilSupplier="0";
        jScrollPane4.setVisible(true);
        jTable4.requestFocus();
        jTable4.getSelectionModel().setSelectionInterval(0, 0);
    }
    if (evt.getKeyCode() == 27) {
        jScrollPane4.setVisible(false);
    }
}//GEN-LAST:event_txtSupplierKeyPressed

private void txtKodeHutangKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtKodeHutangKeyPressed
// TODO add your handling code here:
    if(evt.getKeyCode()==10){
        txtNoref.requestFocus();
    }
}//GEN-LAST:event_txtKodeHutangKeyPressed

private void txtNorefKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtNorefKeyPressed
// TODO add your handling code here:
    if(evt.getKeyCode()==10){
        txtSupplier.requestFocus();
    }
}//GEN-LAST:event_txtNorefKeyPressed

private void txtJumlahHutangKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtJumlahHutangKeyPressed
// TODO add your handling code here:
    if(evt.getKeyCode()==10){
        txtKeterangan.requestFocus();
    }
}//GEN-LAST:event_txtJumlahHutangKeyPressed

private void jTable2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable2MouseClicked
        try {
            // TODO add your handling code here:
                Calendar cld = Calendar.getInstance();
                ht=hutangDao.getDetails(c, Integer.parseInt(jTable2.getValueAt(jTable2.getSelectedRow(),0).toString()));
                IDHUTANG = ht.getID();
                txtKodeHutang.setText(ht.getKODEHUTANG());
                txtNoref.setText(ht.getIDPEMBELIAN()+"");
                cld.setTime(ht.getTANGGAL());
                tglHutang.setSelectedDate(cld);
                cld.setTime(ht.getJATUHTEMPO());
                tglJatuhTempo.setSelectedDate(cld);
                txtSupplier.setText(ht.getIDSUPPLIER());
                txtNamaSupplier.setText(supplierDao.getDetails(c, ht.getIDSUPPLIER()).getNAMA());
                txtJumlahHutang.setValue(ht.getJUMLAH());
                txtKeterangan.setText(ht.getKETERANGAN());
        } catch (SQLException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    
}//GEN-LAST:event_jTable2MouseClicked

private void txtKeteranganKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtKeteranganKeyPressed
// TODO add your handling code here:
    if(evt.getKeyCode()==10){
        btnSimpan.requestFocus();
    }
}//GEN-LAST:event_txtKeteranganKeyPressed

private void btnUpdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpdateActionPerformed
// TODO add your handling code here:
    prosesSimpan("1");
    reloadDataHutang();
    kosongHutang();
}//GEN-LAST:event_btnUpdateActionPerformed

private void jTable1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable1MouseClicked
// TODO add your handling code here:
    txtTotalHutang.setValue(jTable1.getValueAt(jTable1.getSelectedRow(), 2));
    reloadDataPelunasan();
}//GEN-LAST:event_jTable1MouseClicked

private void btnSimpanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSimpanActionPerformed
        try {
            // TODO add your handling code here:
                hutangbayar h = new hutangbayar();
                h.setID(hutangbayarDao.getID(c));
                h.setIDHUTANG(Integer.parseInt(jTable1.getValueAt(jTable1.getSelectedRow(),0).toString()));
                h.setKODEHUTANGBAYAR(txtNoTrans.getText());
                h.setTANGGAL(java.sql.Date.valueOf(tglBayar.getText()));
                h.setJUMLAH(Double.parseDouble(txtJumlahBayar.getValue().toString()));
                if(hutangbayarDao.insertIntoHUTANGBAYAR(c, h)){
                    JOptionPane.showMessageDialog(null, "Entri Data Pelunasan Hutang Ok");
                }else{
                    JOptionPane.showMessageDialog(null, "Entri Data Pelunasan Hutang Gagal");
                }
                if(Double.parseDouble(txtTotalHutang.getValue().toString())==Double.parseDouble(txtJumlahBayar.getValue().toString())){
                   ht=hutangDao.getDetails(c, Integer.parseInt(jTable1.getValueAt(jTable1.getSelectedRow(), 0).toString()));
                   ht.setSTATUS("0");
                   hutangDao.updateHUTANG(c,Integer.parseInt(jTable1.getValueAt(jTable1.getSelectedRow(), 0).toString()) , ht);
                }
                insertJurnal();
                insertRinciJurnal();
                reloadDataPelunasan();
                reloadDataHutangBayar();
        } catch (Exception ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        }
}//GEN-LAST:event_btnSimpanActionPerformed

private void txtKodeSupplier1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtKodeSupplier1ActionPerformed
// TODO add your handling code here:
    jScrollPane4.setVisible(true);
    JDBCAdapter ja = new JDBCAdapter(c);
    ja.executeQuery("select IDSUPPLIER,NAMA from SUPPLIER where IDSUPPLIER like '" + txtSupplier.getText() + "%' or lower(NAMA) like '" + txtSupplier.getText().toLowerCase() + "%'");
    jScrollPane4.getViewport().remove(jTable4);
    jTable4 = new JTable(ja);
    jTable4.addKeyListener(new java.awt.event.KeyAdapter() {
            @Override
        public void keyPressed(java.awt.event.KeyEvent evt) {
            jTable4KeyPressed(evt);
        }
    });
    jTable4.setFont(new Font("Tahoma", Font.BOLD, 12));
    jScrollPane4.getViewport().add(jTable4);
    jScrollPane4.repaint();
}//GEN-LAST:event_txtKodeSupplier1ActionPerformed

private void txtKodeSupplier1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtKodeSupplier1KeyPressed
// TODO add your handling code here:
    if (evt.getKeyCode() == 40) {
        pilSupplier="1";
        jScrollPane4.setVisible(true);
        jTable4.requestFocus();
        jTable4.getSelectionModel().setSelectionInterval(0, 0);
    }
    if (evt.getKeyCode() == 27) {
        jScrollPane4.setVisible(false);
    }
}//GEN-LAST:event_txtKodeSupplier1KeyPressed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(DialogHutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(DialogHutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(DialogHutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(DialogHutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {

            public void run() {
                DialogHutang dialog = new DialogHutang(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {

                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnSimpan;
    private javax.swing.JButton btnUpdate;
    private javax.swing.JComboBox cboBank;
    private javax.swing.JComboBox cboCaraBayar;
    private javax.swing.JButton cmdInsert;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTable jTable1;
    private javax.swing.JTable jTable2;
    private javax.swing.JTable jTable3;
    private javax.swing.JTable jTable4;
    private com.erv.function.PanelCool panelCool1;
    private datechooser.beans.DateChooserCombo tglBayar;
    private datechooser.beans.DateChooserCombo tglHutang;
    private datechooser.beans.DateChooserCombo tglJatuhTempo;
    private javax.swing.JFormattedTextField txtJumlahBayar;
    private javax.swing.JFormattedTextField txtJumlahHutang;
    private javax.swing.JTextField txtKeterangan;
    private javax.swing.JTextField txtKodeHutang;
    private javax.swing.JTextField txtKodeSupplier1;
    private javax.swing.JTextField txtNamaSupplier;
    private javax.swing.JTextField txtNamaSupplier1;
    private javax.swing.JTextField txtNoTrans;
    private javax.swing.JTextField txtNoref;
    private javax.swing.JTextField txtSupplier;
    private javax.swing.JFormattedTextField txtTotalHutang;
    // End of variables declaration//GEN-END:variables

    void kosongHutang() {
        txtKodeHutang.setText("");
        txtNoref.setText("");
        txtSupplier.setText("");
        txtNamaSupplier.setText("");
        txtJumlahHutang.setText("");
        txtKeterangan.setText("");
        txtJumlahHutang.setText("");
        txtKodeHutang.setText(hutangDao.getKodeHutang(c));
    }
    void kosongBayar(){
        txtNoTrans.setText("");
        txtKodeSupplier1.setText("");
        txtNamaSupplier1.setText("");
        txtNoTrans.setText(hutangbayarDao.getKodeHutangBayar(c));
    }
   
    void isiCombo() {
        cboBank.removeAllItems();
        try {
            Statement stat = c.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            ResultSet rs = stat.executeQuery("select * from BANK");
            rs.last();
            if (rs.getRow() > 0) {
                ID = new String[rs.getRow()];
            }
            rs.beforeFirst();
            int i = 0;
            while (rs.next()) {
                ID[i] = rs.getString(1);
                cboBank.addItem(rs.getString(2));
            }
        } catch (SQLException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    void insertHutang() {
        try {
            ht.setID(hutangDao.getID(c));
            ht.setKODEHUTANG(txtKodeHutang.getText());
            ht.setIDPEMBELIAN(IDBELI);
            ht.setJUMLAH(Double.parseDouble(txtTotalHutang.getValue().toString()));
            ht.setTANGGAL(java.sql.Date.valueOf(tglHutang.getText()));
            if (hutangDao.insertIntoHUTANG(c, ht)) {
                JOptionPane.showMessageDialog(this, "Entri Data Ok");
            }
        } catch (SQLException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        }

    }
    void insertJurnal() {
        jurnal j = new jurnal();
        jurnalDao dbjurnal = new jurnalDao();

        try {
            IDJurnal = dbjurnal.getIDJurnal(c);
            j.setID(IDJurnal);
            j.setKODEJURNAL(txtKodeHutang.getText());
            j.setTANGGAL(java.sql.Date.valueOf(tglHutang.getText()));
            j.setDESKRIPSI("Pembayaran Hutang Kepada " + txtSupplier.getText());
            dbjurnal.insertIntoJURNAL(c, j);
        } catch (Exception ex) {
        }
    }
    void insertRinciJurnal() {
        Statement s;
        try {
            s = c.createStatement();
            s.execute("insert into RINCIJURNAL values(" + IDJurnal + ",'" + supplierDao.getDetails(c,txtKodeSupplier1.getText()).getKODEAKUN() + "'," + txtJumlahBayar.getValue().toString() + ",0,1)");
            if(cboCaraBayar.getSelectedIndex()==0){
                s.execute("insert into RINCIJURNAL values(" + IDJurnal + ",'" + settingDao.getAkun(c, "KAS") + "',0," + txtJumlahBayar.getValue().toString() + ",2)");
            }else{
                s.execute("insert into RINCIJURNAL values(" + IDJurnal + ",'" + bankDao.getDetails(c, Integer.parseInt(ID[cboBank.getSelectedIndex()])).getKODEAKUN() + "',0," + txtJumlahBayar.getValue().toString() + ",2)");
            }
            s.close();
        } catch (Exception ex) {
        }
    }
    void reloadDataHutang(){
        JDBCAdapter th=new JDBCAdapter(c);
        String sql="SELECT ID,KETERANGAN,JUMLAH - RETUR - JUMLAHBAYAR as JUMLAH,JATUHTEMPO,STATUS from VIEW_HUTANG where IDSUPPLIER='"+ txtSupplier.getText() +"'";
        th.executeQuery(sql);
        jScrollPane2.getViewport().remove(jTable2);
        jTable2=new JTable(th);
        jTable2.addMouseListener(new java.awt.event.MouseAdapter() {
    public void mouseClicked(java.awt.event.MouseEvent evt) {
        jTable2MouseClicked(evt);
    }
});
        jScrollPane2.getViewport().add(jTable2);
        jScrollPane2.repaint();
    }
    void reloadDataHutangBayar(){
        JDBCAdapter th=new JDBCAdapter(c);
        String sql="SELECT ID,KETERANGAN,JUMLAH - RETUR - JUMLAHBAYAR as JUMLAH,JATUHTEMPO,STATUS from VIEW_HUTANG where IDSUPPLIER='"+ txtKodeSupplier1.getText() +"' AND STATUS='BELUM LUNAS'";
        th.executeQuery(sql);
        jScrollPane1.getViewport().remove(jTable1);
        jTable1=new JTable(th);
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
    public void mouseClicked(java.awt.event.MouseEvent evt) {
        jTable1MouseClicked(evt);
    }
});
        jScrollPane1.getViewport().add(jTable1);
        jScrollPane1.repaint();
    }
    void prosesSimpan(String pil){
        try {
            
            ht.setKODEHUTANG(txtKodeHutang.getText());
            ht.setIDPEMBELIAN(0);
            ht.setTANGGAL(java.sql.Date.valueOf(tglHutang.getText()));
            ht.setJUMLAH(Double.parseDouble(txtJumlahHutang.getValue().toString()));
            ht.setIDSUPPLIER(txtSupplier.getText());
            ht.setJATUHTEMPO(java.sql.Date.valueOf(tglJatuhTempo.getText()));
            ht.setKETERANGAN(txtKeterangan.getText());
            ht.setSTATUS("1");
            boolean stat;
            if(pil.equals("0")){
                ht.setID(hutangDao.getID(c));
                stat=hutangDao.insertIntoHUTANG(c, ht);
            }else{
                stat=hutangDao.updateHUTANG(c,IDHUTANG ,ht);
            }
            if (stat) {
                JOptionPane.showMessageDialog(this, "Update Data Ok");
            } else {
                JOptionPane.showMessageDialog(this, "Update Data Gagal");
            }
        } catch (SQLException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        }
        
    }
    
    void reloadDataPelunasan(){
        JDBCAdapter th=new JDBCAdapter(c);
        String sql="SELECT * FROM HUTANGBAYAR where IDHUTANG="+jTable1.getValueAt(jTable1.getSelectedRow(), 0)+"";
        th.executeQuery(sql);
        jScrollPane3.getViewport().remove(jTable3);
        jTable3=new JTable(th);
        jScrollPane3.getViewport().add(jTable3);
        jScrollPane3.repaint();
    }
}
