/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * DialogPiutang.java
 *
 * Created on Dec 29, 2011, 9:34:00 AM
 */
package javariesoft;

import com.erv.db.bankDao;
import com.erv.db.jurnalDao;
import com.erv.db.koneksi;
import com.erv.db.pelangganDao;
import com.erv.db.penjualanDao;
import com.erv.db.piutangDao;
import com.erv.db.piutangbayarDao;
import com.erv.db.settingDao;
import com.erv.function.JDBCAdapter;
import com.erv.model.jurnal;
import com.erv.model.pelanggan;
import com.erv.model.penjualan;
import com.erv.model.piutang;
import com.erv.model.piutangbayar;
import java.awt.Font;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.JTable;

/**
 *
 * @author erwadi
 */
public class DialogPiutang extends javax.swing.JDialog {
    int IDJurnal = 0;
    String kodePelanggan = "";
    String ID[];
    int IDJUAL = 0;
    int IDPIUTANG=0;
    java.text.DateFormat d = new SimpleDateFormat("yyyy-MM-dd");
    Connection c;
    piutang p;
    String pilPelanggan = "0";
    pelangganDao dbpel;
    penjualanDao dbpj;
    
    /** Creates new form DialogPiutang */
    public DialogPiutang(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        setting();
    }

    public DialogPiutang(java.awt.Frame parent, boolean modal, String idpenjualan) {
        super(parent, modal);
        initComponents();
        setting();
        penjualan pj;
        try {
            pj=dbpj.getDetails(Integer.parseInt(idpenjualan));
            txtKodePelanggan1.setText(pj.getKODEPELANGGAN());
            txtNamaPelanggan1.setText(dbpel.getDetails(pj.getKODEPELANGGAN()).getNAMA());
            reloadDataPiutangBayar();
            jTabbedPane1.setSelectedIndex(1);
        } catch (SQLException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    public void setting() {
        try {
            c = koneksi.getKoneksiJ();
            p = new piutang();
            kosongPiutang();
            kosongBayar();
            isiCombo();
            dbpel=new pelangganDao(c);
            dbpj=new penjualanDao(c);
            tglPiutang.setDateFormat(d);
            tglBayar.setDateFormat(d);
            jScrollPane4.setVisible(false);
            jScrollPane4.setSize(500, 150);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        } catch (SQLException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panelCool1 = new com.erv.function.PanelCool();
        jScrollPane4 = new javax.swing.JScrollPane();
        jTable4 = new javax.swing.JTable();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        txtKodePiutang = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtNoReff = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        tglPiutang = new datechooser.beans.DateChooserCombo();
        jLabel11 = new javax.swing.JLabel();
        tglJatuhTempo = new datechooser.beans.DateChooserCombo();
        jLabel1 = new javax.swing.JLabel();
        txtKodePelanggan = new javax.swing.JTextField();
        txtNamaPelanggan = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        txtJumlahPiutang = new javax.swing.JFormattedTextField();
        jLabel13 = new javax.swing.JLabel();
        txtKeterangan = new javax.swing.JTextField();
        cmdInsert1 = new javax.swing.JButton();
        btnUpdate = new javax.swing.JButton();
        jSeparator2 = new javax.swing.JSeparator();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTable2 = new javax.swing.JTable();
        jPanel2 = new javax.swing.JPanel();
        jLabel15 = new javax.swing.JLabel();
        txtNoTrans = new javax.swing.JTextField();
        jLabel16 = new javax.swing.JLabel();
        tglBayar = new datechooser.beans.DateChooserCombo();
        jLabel14 = new javax.swing.JLabel();
        cboCaraBayar = new javax.swing.JComboBox();
        cboBank = new javax.swing.JComboBox();
        jLabel17 = new javax.swing.JLabel();
        txtKodePelanggan1 = new javax.swing.JTextField();
        txtNamaPelanggan1 = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jLabel4 = new javax.swing.JLabel();
        txtTotalPiutang = new javax.swing.JFormattedTextField();
        jLabel7 = new javax.swing.JLabel();
        txtJumlahBayar = new javax.swing.JFormattedTextField();
        jSeparator3 = new javax.swing.JSeparator();
        btnSimpan = new javax.swing.JButton();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTable3 = new javax.swing.JTable();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setName("Form"); // NOI18N

        panelCool1.setName("panelCool1"); // NOI18N
        panelCool1.setLayout(null);

        jScrollPane4.setName("jScrollPane4"); // NOI18N

        jTable4.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jTable4.setName("jTable4"); // NOI18N
        jTable4.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTable4KeyPressed(evt);
            }
        });
        jScrollPane4.setViewportView(jTable4);

        panelCool1.add(jScrollPane4);
        jScrollPane4.setBounds(150, 150, 50, 20);

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(javariesoft.JavarieSoftApp.class).getContext().getResourceMap(DialogPiutang.class);
        jTabbedPane1.setFont(resourceMap.getFont("jTabbedPane1.font")); // NOI18N
        jTabbedPane1.setName("jTabbedPane1"); // NOI18N

        jPanel1.setName("jPanel1"); // NOI18N
        jPanel1.setLayout(null);

        txtKodePiutang.setFont(resourceMap.getFont("txtKodePiutang.font")); // NOI18N
        txtKodePiutang.setText(resourceMap.getString("txtKodePiutang.text")); // NOI18N
        txtKodePiutang.setName("txtKodePiutang"); // NOI18N
        jPanel1.add(txtKodePiutang);
        txtKodePiutang.setBounds(140, 10, 160, 21);

        jLabel2.setFont(resourceMap.getFont("jLabel2.font")); // NOI18N
        jLabel2.setForeground(resourceMap.getColor("jLabel2.foreground")); // NOI18N
        jLabel2.setText(resourceMap.getString("jLabel2.text")); // NOI18N
        jLabel2.setName("jLabel2"); // NOI18N
        jPanel1.add(jLabel2);
        jLabel2.setBounds(20, 10, 100, 20);

        jLabel3.setFont(resourceMap.getFont("jLabel3.font")); // NOI18N
        jLabel3.setForeground(resourceMap.getColor("jLabel3.foreground")); // NOI18N
        jLabel3.setText(resourceMap.getString("jLabel3.text")); // NOI18N
        jLabel3.setName("jLabel3"); // NOI18N
        jPanel1.add(jLabel3);
        jLabel3.setBounds(330, 10, 100, 16);

        txtNoReff.setFont(resourceMap.getFont("txtNoReff.font")); // NOI18N
        txtNoReff.setText(resourceMap.getString("txtNoReff.text")); // NOI18N
        txtNoReff.setName("txtNoReff"); // NOI18N
        jPanel1.add(txtNoReff);
        txtNoReff.setBounds(450, 10, 160, 21);

        jLabel8.setFont(resourceMap.getFont("jLabel8.font")); // NOI18N
        jLabel8.setForeground(resourceMap.getColor("jLabel8.foreground")); // NOI18N
        jLabel8.setText(resourceMap.getString("jLabel8.text")); // NOI18N
        jLabel8.setName("jLabel8"); // NOI18N
        jPanel1.add(jLabel8);
        jLabel8.setBounds(330, 40, 100, 16);

        tglPiutang.setFieldFont(resourceMap.getFont("tglPiutang.dch_combo_fieldFont")); // NOI18N
        jPanel1.add(tglPiutang);
        tglPiutang.setBounds(140, 40, 155, 20);

        jLabel11.setFont(resourceMap.getFont("jLabel11.font")); // NOI18N
        jLabel11.setText(resourceMap.getString("jLabel11.text")); // NOI18N
        jLabel11.setName("jLabel11"); // NOI18N
        jPanel1.add(jLabel11);
        jLabel11.setBounds(20, 40, 100, 16);

        tglJatuhTempo.setFieldFont(resourceMap.getFont("tglJatuhTempo.dch_combo_fieldFont")); // NOI18N
        jPanel1.add(tglJatuhTempo);
        tglJatuhTempo.setBounds(450, 40, 155, 20);

        jLabel1.setFont(resourceMap.getFont("jLabel1.font")); // NOI18N
        jLabel1.setForeground(resourceMap.getColor("jLabel1.foreground")); // NOI18N
        jLabel1.setText(resourceMap.getString("jLabel1.text")); // NOI18N
        jLabel1.setName("jLabel1"); // NOI18N
        jPanel1.add(jLabel1);
        jLabel1.setBounds(20, 130, 100, 15);

        txtKodePelanggan.setFont(resourceMap.getFont("txtKodePelanggan.font")); // NOI18N
        txtKodePelanggan.setText(resourceMap.getString("txtKodePelanggan.text")); // NOI18N
        txtKodePelanggan.setName("txtKodePelanggan"); // NOI18N
        txtKodePelanggan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtKodePelangganActionPerformed(evt);
            }
        });
        txtKodePelanggan.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtKodePelangganKeyPressed(evt);
            }
        });
        jPanel1.add(txtKodePelanggan);
        txtKodePelanggan.setBounds(140, 70, 160, 21);

        txtNamaPelanggan.setFont(resourceMap.getFont("txtNamaPelanggan.font")); // NOI18N
        txtNamaPelanggan.setText(resourceMap.getString("txtNamaPelanggan.text")); // NOI18N
        txtNamaPelanggan.setName("txtNamaPelanggan"); // NOI18N
        jPanel1.add(txtNamaPelanggan);
        txtNamaPelanggan.setBounds(310, 70, 300, 21);

        jLabel12.setFont(resourceMap.getFont("jLabel12.font")); // NOI18N
        jLabel12.setText(resourceMap.getString("jLabel12.text")); // NOI18N
        jLabel12.setName("jLabel12"); // NOI18N
        jPanel1.add(jLabel12);
        jLabel12.setBounds(20, 70, 100, 16);

        txtJumlahPiutang.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0.00"))));
        txtJumlahPiutang.setName("txtJumlahPiutang"); // NOI18N
        jPanel1.add(txtJumlahPiutang);
        txtJumlahPiutang.setBounds(140, 100, 160, 20);

        jLabel13.setFont(resourceMap.getFont("jLabel13.font")); // NOI18N
        jLabel13.setText(resourceMap.getString("jLabel13.text")); // NOI18N
        jLabel13.setName("jLabel13"); // NOI18N
        jPanel1.add(jLabel13);
        jLabel13.setBounds(20, 100, 100, 16);

        txtKeterangan.setFont(resourceMap.getFont("txtKeterangan.font")); // NOI18N
        txtKeterangan.setText(resourceMap.getString("txtKeterangan.text")); // NOI18N
        txtKeterangan.setName("txtKeterangan"); // NOI18N
        jPanel1.add(txtKeterangan);
        txtKeterangan.setBounds(140, 130, 470, 21);

        cmdInsert1.setFont(resourceMap.getFont("cmdInsert1.font")); // NOI18N
        cmdInsert1.setText(resourceMap.getString("cmdInsert1.text")); // NOI18N
        cmdInsert1.setName("cmdInsert1"); // NOI18N
        cmdInsert1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdInsert1ActionPerformed(evt);
            }
        });
        jPanel1.add(cmdInsert1);
        cmdInsert1.setBounds(20, 170, 100, 30);

        btnUpdate.setFont(resourceMap.getFont("btnUpdate.font")); // NOI18N
        btnUpdate.setText(resourceMap.getString("btnUpdate.text")); // NOI18N
        btnUpdate.setName("btnUpdate"); // NOI18N
        btnUpdate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUpdateActionPerformed(evt);
            }
        });
        jPanel1.add(btnUpdate);
        btnUpdate.setBounds(130, 170, 110, 30);

        jSeparator2.setName("jSeparator2"); // NOI18N
        jPanel1.add(jSeparator2);
        jSeparator2.setBounds(20, 210, 730, 10);

        jScrollPane2.setName("jScrollPane2"); // NOI18N

        jTable2.setName("jTable2"); // NOI18N
        jTable2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable2MouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(jTable2);

        jPanel1.add(jScrollPane2);
        jScrollPane2.setBounds(20, 220, 730, 180);

        jTabbedPane1.addTab(resourceMap.getString("jPanel1.TabConstraints.tabTitle"), jPanel1); // NOI18N

        jPanel2.setName("jPanel2"); // NOI18N
        jPanel2.setLayout(null);

        jLabel15.setFont(resourceMap.getFont("jLabel15.font")); // NOI18N
        jLabel15.setText(resourceMap.getString("jLabel15.text")); // NOI18N
        jLabel15.setName("jLabel15"); // NOI18N
        jPanel2.add(jLabel15);
        jLabel15.setBounds(20, 20, 110, 16);

        txtNoTrans.setFont(resourceMap.getFont("txtNoTrans.font")); // NOI18N
        txtNoTrans.setText(resourceMap.getString("txtNoTrans.text")); // NOI18N
        txtNoTrans.setName("txtNoTrans"); // NOI18N
        jPanel2.add(txtNoTrans);
        txtNoTrans.setBounds(150, 20, 150, 22);

        jLabel16.setFont(resourceMap.getFont("jLabel16.font")); // NOI18N
        jLabel16.setText(resourceMap.getString("jLabel16.text")); // NOI18N
        jLabel16.setName("jLabel16"); // NOI18N
        jPanel2.add(jLabel16);
        jLabel16.setBounds(20, 50, 110, 16);

        tglBayar.setFieldFont(resourceMap.getFont("tglBayar.dch_combo_fieldFont")); // NOI18N
        jPanel2.add(tglBayar);
        tglBayar.setBounds(150, 50, 155, 20);

        jLabel14.setFont(resourceMap.getFont("jLabel14.font")); // NOI18N
        jLabel14.setText(resourceMap.getString("jLabel14.text")); // NOI18N
        jLabel14.setName("jLabel14"); // NOI18N
        jPanel2.add(jLabel14);
        jLabel14.setBounds(320, 50, 100, 16);

        cboCaraBayar.setFont(resourceMap.getFont("cboCaraBayar.font")); // NOI18N
        cboCaraBayar.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "KAS", "BANK" }));
        cboCaraBayar.setName("cboCaraBayar"); // NOI18N
        jPanel2.add(cboCaraBayar);
        cboCaraBayar.setBounds(410, 50, 80, 21);

        cboBank.setFont(resourceMap.getFont("cboBank.font")); // NOI18N
        cboBank.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cboBank.setName("cboBank"); // NOI18N
        jPanel2.add(cboBank);
        cboBank.setBounds(510, 50, 140, 21);

        jLabel17.setFont(resourceMap.getFont("jLabel17.font")); // NOI18N
        jLabel17.setText(resourceMap.getString("jLabel17.text")); // NOI18N
        jLabel17.setName("jLabel17"); // NOI18N
        jPanel2.add(jLabel17);
        jLabel17.setBounds(20, 80, 100, 16);

        txtKodePelanggan1.setFont(resourceMap.getFont("txtKodePelanggan1.font")); // NOI18N
        txtKodePelanggan1.setText(resourceMap.getString("txtKodePelanggan1.text")); // NOI18N
        txtKodePelanggan1.setName("txtKodePelanggan1"); // NOI18N
        jPanel2.add(txtKodePelanggan1);
        txtKodePelanggan1.setBounds(150, 80, 160, 22);

        txtNamaPelanggan1.setFont(resourceMap.getFont("txtNamaPelanggan1.font")); // NOI18N
        txtNamaPelanggan1.setText(resourceMap.getString("txtNamaPelanggan1.text")); // NOI18N
        txtNamaPelanggan1.setName("txtNamaPelanggan1"); // NOI18N
        jPanel2.add(txtNamaPelanggan1);
        txtNamaPelanggan1.setBounds(320, 80, 330, 22);

        jScrollPane1.setName("jScrollPane1"); // NOI18N

        jTable1.setName("jTable1"); // NOI18N
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable1MouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(jTable1);

        jPanel2.add(jScrollPane1);
        jScrollPane1.setBounds(20, 110, 730, 110);

        jLabel4.setFont(resourceMap.getFont("jLabel4.font")); // NOI18N
        jLabel4.setForeground(resourceMap.getColor("jLabel4.foreground")); // NOI18N
        jLabel4.setText(resourceMap.getString("jLabel4.text")); // NOI18N
        jLabel4.setName("jLabel4"); // NOI18N
        jPanel2.add(jLabel4);
        jLabel4.setBounds(20, 230, 100, 16);

        txtTotalPiutang.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0"))));
        txtTotalPiutang.setFont(resourceMap.getFont("txtTotalPiutang.font")); // NOI18N
        txtTotalPiutang.setName("txtTotalPiutang"); // NOI18N
        jPanel2.add(txtTotalPiutang);
        txtTotalPiutang.setBounds(140, 230, 160, 21);

        jLabel7.setFont(resourceMap.getFont("jLabel7.font")); // NOI18N
        jLabel7.setForeground(resourceMap.getColor("jLabel7.foreground")); // NOI18N
        jLabel7.setText(resourceMap.getString("jLabel7.text")); // NOI18N
        jLabel7.setName("jLabel7"); // NOI18N
        jPanel2.add(jLabel7);
        jLabel7.setBounds(370, 230, 100, 16);

        txtJumlahBayar.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0"))));
        txtJumlahBayar.setName("txtJumlahBayar"); // NOI18N
        jPanel2.add(txtJumlahBayar);
        txtJumlahBayar.setBounds(490, 230, 160, 20);

        jSeparator3.setName("jSeparator3"); // NOI18N
        jPanel2.add(jSeparator3);
        jSeparator3.setBounds(20, 260, 730, 10);

        btnSimpan.setFont(resourceMap.getFont("btnSimpan.font")); // NOI18N
        btnSimpan.setText(resourceMap.getString("btnSimpan.text")); // NOI18N
        btnSimpan.setName("btnSimpan"); // NOI18N
        btnSimpan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSimpanActionPerformed(evt);
            }
        });
        jPanel2.add(btnSimpan);
        btnSimpan.setBounds(20, 280, 80, 30);

        jScrollPane3.setName("jScrollPane3"); // NOI18N

        jTable3.setName("jTable3"); // NOI18N
        jScrollPane3.setViewportView(jTable3);

        jPanel2.add(jScrollPane3);
        jScrollPane3.setBounds(150, 280, 600, 120);

        jTabbedPane1.addTab(resourceMap.getString("jPanel2.TabConstraints.tabTitle"), jPanel2); // NOI18N

        panelCool1.add(jTabbedPane1);
        jTabbedPane1.setBounds(20, 20, 770, 440);

        getContentPane().add(panelCool1, java.awt.BorderLayout.CENTER);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-821)/2, (screenSize.height-517)/2, 821, 517);
    }// </editor-fold>//GEN-END:initComponents

private void cmdInsert1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdInsert1ActionPerformed
// TODO add your handling code here:
    prosesSimpan("0");
    reloadDataPiutang();
    kosongPiutang();
}//GEN-LAST:event_cmdInsert1ActionPerformed

private void btnUpdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpdateActionPerformed
// TODO add your handling code here:
    prosesSimpan("1");
    reloadDataPiutang();
    kosongPiutang();
}//GEN-LAST:event_btnUpdateActionPerformed

private void jTable2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable2MouseClicked
    try {
        // TODO add your handling code here:
        Calendar cld = Calendar.getInstance();
        p = piutangDao.getDetails(c, Integer.parseInt(jTable2.getValueAt(jTable2.getSelectedRow(), 0).toString()));
        IDPIUTANG= p.getID();
        txtKodePiutang.setText(p.getKODEPIUTANG());
        txtNoReff.setText(p.getIDPENJUALAN() + "");
        cld.setTime(p.getTANGGAL());
        tglPiutang.setSelectedDate(cld);
        cld.setTime(p.getJATUHTEMPO());
        tglJatuhTempo.setSelectedDate(cld);
        txtKodePelanggan.setText(p.getIDPELANGGAN());
        txtNamaPelanggan.setText(dbpel.getDetails(txtKodePelanggan.getText()).getNAMA());
        txtTotalPiutang.setValue(p.getJUMLAH());
        txtKeterangan.setText(p.getKETERANGAN());
    } catch (SQLException ex) {
        Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
    } catch (ClassNotFoundException ex) {
        Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
    }

}//GEN-LAST:event_jTable2MouseClicked

private void jTable1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable1MouseClicked
// TODO add your handling code here:
    txtTotalPiutang.setValue(jTable1.getValueAt(jTable1.getSelectedRow(), 2));
    reloadDataPelunasan();
}//GEN-LAST:event_jTable1MouseClicked

private void btnSimpanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSimpanActionPerformed
    try {
        // TODO add your handling code here:
        piutangbayar h = new piutangbayar();
        h.setID(piutangbayarDao.getID(c));
        h.setIDPIUTANG(Integer.parseInt(jTable1.getValueAt(jTable1.getSelectedRow(), 0).toString()));
        h.setKODEPIUTANGBAYAR(txtNoTrans.getText());
        h.setTANGGAL(java.sql.Date.valueOf(tglBayar.getText()));
        h.setJUMLAH(Double.parseDouble(txtJumlahBayar.getValue().toString()));
        if (piutangbayarDao.insertIntoPIUTANGBAYAR(c, h)) {
            JOptionPane.showMessageDialog(null, "Entri Data Pelunasan Hutang Ok");
        } else {
            JOptionPane.showMessageDialog(null, "Entri Data Pelunasan Hutang Gagal");
        }
        if (Double.parseDouble(txtTotalPiutang.getValue().toString()) == Double.parseDouble(txtJumlahBayar.getValue().toString())) {
            p = piutangDao.getDetails(c, Integer.parseInt(jTable1.getValueAt(jTable1.getSelectedRow(), 0).toString()));
            p.setSTATUS("0");
            piutangDao.updatePIUTANG(c,p);
        }
        insertJurnal();
        insertRinciJurnal();
        reloadDataPelunasan();
        reloadDataPiutangBayar();
    } catch (Exception ex) {
        Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
    }
}//GEN-LAST:event_btnSimpanActionPerformed

private void jTable4KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTable4KeyPressed
// TODO add your handling code here:
    if (evt.getKeyCode() == 10) {
        try {
            pelanggan b = new pelanggan();
            b = dbpel.getDetails(jTable4.getValueAt(jTable4.getSelectedRow(), 0).toString());
            if (pilPelanggan.equals("0")) {
                txtKodePelanggan.setText(b.getKODEPELANGGAN());
                txtNamaPelanggan.setText(b.getNAMA());
                jScrollPane4.setVisible(false);
                reloadDataPiutang();
                txtTotalPiutang.requestFocus();
            } else if (pilPelanggan.equals("1")) {
                txtKodePelanggan1.setText(b.getKODEPELANGGAN());
                txtNamaPelanggan1.setText(b.getNAMA());
                jScrollPane4.setVisible(false);
            }

        } catch (Exception ex) {
        }
    }
}//GEN-LAST:event_jTable4KeyPressed

private void txtKodePelangganActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtKodePelangganActionPerformed
// TODO add your handling code here:
    reloadPelanggan("0");
}//GEN-LAST:event_txtKodePelangganActionPerformed

private void txtKodePelangganKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtKodePelangganKeyPressed
// TODO add your handling code here:
    if (evt.getKeyCode() == 40) {
        pilPelanggan="0";
        jScrollPane4.setVisible(true);
        jTable4.requestFocus();
        jTable4.getSelectionModel().setSelectionInterval(0, 0);
    }
    if (evt.getKeyCode() == 27) {
        jScrollPane4.setVisible(false);
    }
}//GEN-LAST:event_txtKodePelangganKeyPressed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(DialogPiutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(DialogPiutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(DialogPiutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(DialogPiutang.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {

            public void run() {
                DialogPiutang dialog = new DialogPiutang(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {

                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnSimpan;
    private javax.swing.JButton btnUpdate;
    private javax.swing.JComboBox cboBank;
    private javax.swing.JComboBox cboCaraBayar;
    private javax.swing.JButton cmdInsert1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTable jTable1;
    private javax.swing.JTable jTable2;
    private javax.swing.JTable jTable3;
    private javax.swing.JTable jTable4;
    private com.erv.function.PanelCool panelCool1;
    private datechooser.beans.DateChooserCombo tglBayar;
    private datechooser.beans.DateChooserCombo tglJatuhTempo;
    private datechooser.beans.DateChooserCombo tglPiutang;
    public javax.swing.JFormattedTextField txtJumlahBayar;
    private javax.swing.JFormattedTextField txtJumlahPiutang;
    private javax.swing.JTextField txtKeterangan;
    private javax.swing.JTextField txtKodePelanggan;
    private javax.swing.JTextField txtKodePelanggan1;
    private javax.swing.JTextField txtKodePiutang;
    private javax.swing.JTextField txtNamaPelanggan;
    private javax.swing.JTextField txtNamaPelanggan1;
    private javax.swing.JTextField txtNoReff;
    private javax.swing.JTextField txtNoTrans;
    private javax.swing.JFormattedTextField txtTotalPiutang;
    // End of variables declaration//GEN-END:variables

    void kosongPiutang() {
        txtKodePiutang.setText("");
        txtJumlahBayar.setText("");
        txtTotalPiutang.setText("");
        txtNoReff.setText("0");
        txtKodePelanggan.setText("");
        txtNamaPelanggan.setText("");
        txtKeterangan.setText("");
        txtKodePiutang.setText(piutangDao.getKodePiutang(c));
    }

    void kosongBayar(){
        txtNoTrans.setText("");
        txtKodePelanggan1.setText("");
        txtNamaPelanggan1.setText("");
        txtNoTrans.setText(piutangbayarDao.getKodePiutangBayar(c));
    }
    
    void isiCombo() {
        cboBank.removeAllItems();
        try {
            Statement stat = c.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);
            ResultSet rs = stat.executeQuery("select * from BANK");
            rs.last();
            if (rs.getRow() > 0) {
                ID = new String[rs.getRow()];
            }
            rs.beforeFirst();
            int i = 0;
            while (rs.next()) {
                ID[i] = rs.getString(1);
                cboBank.addItem(rs.getString(2));
            }
        } catch (SQLException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    void insertPiutang() {
        try {
            p.setID(piutangDao.getID(c));
            p.setKODEPIUTANG(txtKodePiutang.getText());
            p.setIDPENJUALAN(IDJUAL);
            p.setJUMLAH(Double.parseDouble(txtJumlahBayar.getValue().toString()));
            p.setTANGGAL(java.sql.Date.valueOf(tglPiutang.getText()));
            if (piutangDao.insertIntoPIUTANG(c, p)) {
                JOptionPane.showMessageDialog(this, "Entri Data Ok");
            }
        } catch (SQLException ex) {
            Logger.getLogger(DialogPiutang.class.getName()).log(Level.SEVERE, null, ex);
        }

    }

    void insertJurnal() {
        jurnal j = new jurnal();
        jurnalDao dbjurnal = new jurnalDao();

        try {
            IDJurnal = dbjurnal.getIDJurnal(c);
            j.setID(IDJurnal);
            j.setKODEJURNAL(txtKodePiutang.getText());
            j.setTANGGAL(java.sql.Date.valueOf(tglPiutang.getText()));
            j.setDESKRIPSI("Pembayaran Piutang Oleh " + txtNamaPelanggan1.getText());
            dbjurnal.insertIntoJURNAL(c, j);
        } catch (Exception ex) {
        }
    }

    void insertRinciJurnal() {
        Statement s;
        try {
            pelangganDao dbplg = new pelangganDao(c);
            s = c.createStatement();
            if (cboCaraBayar.getSelectedIndex() == 0) {
                s.execute("insert into RINCIJURNAL values(" + IDJurnal + ",'" + settingDao.getAkun(c, "KAS") + "'," + txtJumlahBayar.getValue().toString() + ",0,1)");
            } else {
                s.execute("insert into RINCIJURNAL values(" + IDJurnal + ",'" + bankDao.getDetails(c, Integer.parseInt(ID[cboBank.getSelectedIndex()])).getKODEAKUN() + "'," + txtJumlahBayar.getValue().toString() + ",0,1)");
            }
            s.execute("insert into RINCIJURNAL values(" + IDJurnal + ",'" + dbplg.getDetails(txtKodePelanggan1.getText()).getKODEAKUN() + "',0," + txtJumlahBayar.getValue().toString() + ",2)");
            s.close();
            dbplg = null;
        } catch (Exception ex) {
        }
    }

    void reloadPelanggan(String pil) {
        String kodepelanggan="";
        String namapelanggan="";
        if(pil.equals("0")){
            kodepelanggan=txtKodePelanggan.getText();
            namapelanggan=txtNamaPelanggan.getText();
        }else{
            kodepelanggan=txtKodePelanggan1.getText();
            namapelanggan=txtNamaPelanggan1.getText();
        }
        jScrollPane4.setVisible(true);
        JDBCAdapter ja = new JDBCAdapter(c);
        ja.executeQuery("select KODEPELANGGAN,NAMA from PELANGGAN where KODEPELANGGAN like '" + kodepelanggan + "%' or lower(NAMA) like '" + namapelanggan.toLowerCase() + "%'");
        jScrollPane4.getViewport().remove(jTable4);
        jTable4 = new JTable(ja);
        jTable4.addKeyListener(new java.awt.event.KeyAdapter() {

            @Override
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTable4KeyPressed(evt);
            }
        });
        jTable4.setFont(new Font("Tahoma", Font.BOLD, 12));
        jScrollPane4.getViewport().add(jTable4);
        jScrollPane4.repaint();
    }

    void reloadDataPiutang() {
        JDBCAdapter th = new JDBCAdapter(c);
        String sql = "SELECT ID,KETERANGAN,JUMLAH - RETUR - JUMLAHBAYAR as JUMLAH,JATUHTEMPO,STATUS from VIEW_PIUTANG where IDPELANGGAN='" + txtKodePelanggan.getText() + "'";
        th.executeQuery(sql);
        jScrollPane2.getViewport().remove(jTable2);
        jTable2 = new JTable(th);
        jTable2.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable2MouseClicked(evt);
            }
        });
        jScrollPane2.getViewport().add(jTable2);
        jScrollPane2.repaint();
    }
    void reloadDataPiutangBayar(){
        JDBCAdapter th=new JDBCAdapter(c);
        String sql="SELECT ID,KETERANGAN,(JUMLAH - RETUR - JUMLAHBAYAR) as JUMLAH,JATUHTEMPO,STATUS from VIEW_PIUTANG where IDPELANGGAN='"+ txtKodePelanggan1.getText() +"' AND STATUS='BELUM LUNAS'";
        th.executeQuery(sql);
        jScrollPane1.getViewport().remove(jTable1);
        jTable1=new JTable(th);
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
    public void mouseClicked(java.awt.event.MouseEvent evt) {
        jTable1MouseClicked(evt);
    }
});
        jScrollPane1.getViewport().add(jTable1);
        jScrollPane1.repaint();
    }

    void prosesSimpan(String pil) {
        try {
            p.setKODEPIUTANG(txtKodePiutang.getText());
            p.setIDPENJUALAN(0);
            p.setTANGGAL(java.sql.Date.valueOf(tglPiutang.getText()));
            p.setJUMLAH(Double.parseDouble(txtJumlahPiutang.getValue().toString()));
            p.setIDPELANGGAN(txtKodePelanggan.getText());
            p.setJATUHTEMPO(java.sql.Date.valueOf(tglJatuhTempo.getText()));
            p.setKETERANGAN(txtKeterangan.getText());
            p.setSTATUS("1");
            boolean stat;
            if (pil.equals("0")) {
                p.setID(piutangDao.getID(c));
                stat = piutangDao.insertIntoPIUTANG(c, p);
            } else {
                stat = piutangDao.updatePIUTANG(c, p);
            }
            if (stat) {
                JOptionPane.showMessageDialog(this, "Update Data Ok");
            } else {
                JOptionPane.showMessageDialog(this, "Update Data Gagal");
            }
        } catch (SQLException ex) {
            Logger.getLogger(DialogHutang.class.getName()).log(Level.SEVERE, null, ex);
        }

    }
     void reloadDataPelunasan(){
        JDBCAdapter th=new JDBCAdapter(c);
        String sql="SELECT * FROM PIUTANGBAYAR where IDPIUTANG="+jTable1.getValueAt(jTable1.getSelectedRow(), 0)+"";
        th.executeQuery(sql);
        jScrollPane3.getViewport().remove(jTable3);
        jTable3=new JTable(th);
        jScrollPane3.getViewport().add(jTable3);
        jScrollPane3.repaint();
    }
}
